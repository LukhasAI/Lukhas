tasks:
  _default_:
    - kind: require_provenance
    - kind: mask_pii
    - kind: budget_limit
      max_tokens: 200000
    - kind: require_provenance_record
      require_attestation: true  # Enable for signature verification testing
      verify_signature: true  # Enable signature verification with PyNaCl
      require_storage_url: true
      allow_inline_record: true
  generate_summary:
    - kind: content_policy
      categories: [adult, hate, illegal]
  answer_medical:
    - kind: content_policy
      categories: [medical_high_risk]
    - kind: age_gate
      min_age: 18
    - kind: require_provenance_record
      require_attestation: true
      verify_signature: false  # Enable when PyNaCl is available
      require_storage_url: true
  pii_processing:
    - kind: require_consent
      purpose: "pii_processing"
    - kind: mask_pii
    - kind: content_policy
      categories: [adult, hate, illegal]
  data_analysis:
    - kind: require_consent
      purpose: "analytics"
    - kind: budget_limit
      max_tokens: 50000
  model_training:
    - kind: require_consent
      purpose: "model_improvement"
    - kind: require_provenance
    - kind: mask_pii
  personalize_reply:
    - kind: require_fresh_consent
      purpose: personalization
      user_key: user_id
      require_fields: [style_weights, avg_len]
      within_days: 180
    - kind: budget_limit
      max_tokens: 10000
  research_qa:
    - kind: require_capabilities
      subject_key: user_id
      caps: [net, api:search]
    - kind: budget_limit
      max_tokens: 50000
  code_assistant:
    - kind: require_capabilities
      subject_key: user_id
      caps: [fs:read, fs:write]
      fs_paths: [/tmp/**, /Users/*/LOCAL-REPOS/**]
    - kind: mask_pii

  self_heal_apply:
    - kind: require_capabilities
      subject_key: user_id
      caps: [fs:write]
      fs_paths: [/Users/*/LOCAL-REPOS/Lukhas/**]
    - kind: require_change_approval
      proposal_id_key: proposal_id

  safety_check:
    - kind: require_fresh_consent
      purpose: safety_analysis
      within_days: 30
    - kind: require_capabilities
      caps: [safety:moderate]

  identity_verify:
    - kind: require_fresh_consent
      purpose: identity_verification
      within_days: 7
    - kind: age_gate
      min_age: 18

router:
  task_specific:
    risk_bias: 0.0
    safety_threshold: 0.85
