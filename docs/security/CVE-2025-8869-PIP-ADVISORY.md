---
status: active
type: security-advisory
severity: high
owner: security-team
priority: P0
track: E-Security-Sweep
---

# ðŸ”´ Security Advisory: pip Arbitrary File Overwrite (CVE-2025-8869)

## Executive Summary

**CVE ID**: CVE-2025-8869  
**GHSA ID**: GHSA-4xh5-x5gv-qwph  
**Severity**: **HIGH**  
**Package**: pip  
**Affected Versions**: pip < 25.3  
**Current LUKHAS Version**: 24.0 (safe) / 25.2 (vulnerable if upgraded)  
**Status**: Awaiting pip 25.3 release (fix available in PR)

---

## Vulnerability Details

### Description

In the fallback extraction path for source distributions, `pip` uses Python's `tarfile` module without verifying that symbolic/hard link targets resolve inside the intended extraction directory. A malicious sdist can include links that escape the target directory and overwrite arbitrary files on the invoking host during `pip install`.

### Attack Vector

An attacker can craft a malicious source distribution (sdist) package that:
1. Contains symbolic or hard links pointing outside the extraction directory
2. When installed via `pip install`, escapes the build directory
3. Overwrites arbitrary files on the system with the permissions of the user running pip
4. Can potentially lead to code execution if critical system files are overwritten

### Impact

**Direct Impact**:
- **Arbitrary File Overwrite**: Attacker can overwrite any file accessible to the user running pip
- **Integrity Compromise**: System configuration files, startup scripts, or application code can be tampered with
- **Potential Code Execution**: Depending on which files are overwritten (e.g., `.bashrc`, `.profile`, cron jobs)

**Conditions Required**:
- Installing an attacker-controlled source distribution package
- Fallback extraction code path must be triggered
- No special privileges required beyond running `pip install`
- Active user action is necessary

---

## Affected Systems

### LUKHAS AI Platform

**Current Status**: âœ… **NOT VULNERABLE** (using pip 24.0)

**Risk Assessment**:
- **Development Environments**: LOW - Developers typically install from trusted sources
- **CI/CD Pipelines**: MEDIUM - Automated builds could be targeted
- **Production Deployments**: LOW - Uses pinned dependencies from known sources
- **Contributor Onboarding**: MEDIUM - New contributors may install from various sources

**Attack Scenarios**:
1. **Typosquatting**: Installing a package with a name similar to a legitimate one
2. **Compromised PyPI Index**: Installing from an untrusted or compromised package index
3. **Supply Chain Attack**: Legitimate package compromised to include malicious sdist
4. **Internal Package Repository**: If hosting internal packages without integrity checks

---

## Mitigation Strategy

### Immediate Actions (âœ… Implemented)

1. **Document the Risk** âœ…
   - Created comprehensive security advisory (this document)
   - Added to security monitoring dashboard
   - Included in incident response procedures

2. **Developer Awareness** ðŸ”„ In Progress
   - [ ] Notify team via security@lukhas.ai
   - [ ] Update onboarding documentation
   - [ ] Add to security training materials
   - [ ] Include in weekly security briefing

3. **Secure Package Installation Practices** âœ…
   ```bash
   # Only install from trusted sources
   pip install --index-url https://pypi.org/simple/ <package>
   
   # Verify package integrity
   pip install --require-hashes -r requirements.txt
   
   # Use dependency hash verification
   pip-compile --generate-hashes requirements.in
   ```

### Short-term Actions (ðŸ”„ In Progress)

1. **Monitor pip 25.3 Release** ðŸ”„
   - Subscribe to pip security announcements
   - Watch GitHub repository: https://github.com/pypa/pip
   - Monitor GHSA-4xh5-x5gv-qwph advisory
   - Track fix PR: https://github.com/pypa/pip/pull/13550

2. **Enhanced CI/CD Security** ðŸ”„
   - [ ] Add package source verification
   - [ ] Implement dependency provenance checks
   - [ ] Enable SLSA supply chain verification
   - [ ] Add runtime integrity monitoring

3. **Security Automation** ðŸ”„
   - [ ] Automated pip version monitoring
   - [ ] Alert when pip 25.3 is released
   - [ ] Scheduled security scan reviews
   - [ ] Dependency update notifications

### Long-term Actions (ðŸ“‹ Planned)

1. **Upgrade to pip 25.3** (When Available)
   ```bash
   # After pip 25.3 release
   pip install --upgrade pip==25.3
   
   # Verify fix
   pip --version
   pip-audit --package pip
   
   # Update requirements
   echo "pip>=25.3" >> requirements.txt
   ```

2. **Consider Python 3.13+ Migration**
   - Python 3.13+ implements PEP 706 (safe tarfile extraction)
   - Provides defense-in-depth for tarfile vulnerabilities
   - Timeline: Evaluate in Q2 2025

3. **Implement Supply Chain Security Framework**
   - SLSA Level 3 compliance for builds
   - Sigstore/Cosign for package signing
   - Software Bill of Materials (SBOM) generation
   - Dependency review automation

---

## Detection & Monitoring

### Signs of Exploitation

Monitor for suspicious activities:

```bash
# Check for unexpected file modifications
find /etc /usr/local/bin ~/.bashrc ~/.profile -type f -mtime -1 -ls

# Review pip installation logs
grep "pip install" /var/log/syslog | grep -E "(sdist|tar\.gz)"

# Audit file integrity
aide --check  # If AIDE is configured
tripwire --check  # If Tripwire is configured
```

### Monitoring Dashboards

**Metrics to Track**:
- Pip installation attempts from untrusted sources
- Failed integrity checks on packages
- Unexpected file system modifications during builds
- CI/CD pipeline anomalies

**Alerting Rules**:
```yaml
# Example Prometheus alert
- alert: SuspiciousPipInstall
  expr: |
    increase(pip_install_total{source!="pypi.org"}[5m]) > 0
  annotations:
    summary: "Pip install from untrusted source detected"
```

---

## Workarounds

Until pip 25.3 is released, implement these defenses:

### 1. Restrict Package Sources

Configure pip to only use trusted indexes:

```ini
# ~/.pip/pip.conf or /etc/pip.conf
[global]
index-url = https://pypi.org/simple
trusted-host = pypi.org
```

### 2. Use Virtual Environments

Isolate package installations:

```bash
# Create isolated environment
python -m venv .venv
source .venv/bin/activate

# Install with restricted permissions
pip install --user <package>
```

### 3. Run with Least Privilege

```bash
# Create dedicated user for builds
sudo useradd -r -s /bin/false pipbuilder

# Run installations as non-privileged user
sudo -u pipbuilder pip install <package>
```

### 4. Use Container Isolation

```dockerfile
# Dockerfile with security hardening
FROM python:3.12-slim

# Non-root user
RUN useradd -m -u 1000 appuser
USER appuser

# Read-only root filesystem
RUN pip install --user <packages>
```

### 5. Implement File System Monitoring

```bash
# Install auditd for file system monitoring
sudo apt-get install auditd

# Monitor pip build directories
sudo auditctl -w /tmp -p wa -k pip_builds
sudo auditctl -w /home/*/.cache/pip -p wa -k pip_cache
```

---

## Testing & Verification

### Verify Current Status

```bash
# Check pip version
pip --version

# Run security audit
pip-audit --package pip

# Check for CVE-2025-8869
pip-audit --vulnerability-service osv --package pip | grep -i "GHSA-4xh5-x5gv-qwph"
```

### Test Mitigation Controls

```bash
# Test package source restriction
pip install --dry-run --index-url https://example.com/simple some-package
# Should fail if configured correctly

# Test hash verification
pip install --require-hashes -r requirements.txt
# Should succeed only with valid hashes

# Test non-root installation
pip install --user --prefix=/tmp/test-install some-package
# Should install to user directory only
```

---

## Incident Response

### If Exploitation Suspected

1. **Immediate Actions**
   ```bash
   # Isolate the system
   sudo iptables -A INPUT -j DROP
   sudo iptables -A OUTPUT -j DROP
   
   # Preserve evidence
   sudo tar czf /tmp/evidence-$(date +%Y%m%d-%H%M%S).tar.gz \
     /var/log/ ~/.bash_history ~/.pip/
   
   # Check for file modifications
   sudo find / -type f -mtime -1 -ls > /tmp/recent-modifications.txt
   ```

2. **Containment**
   - Disconnect affected systems from network
   - Revoke credentials used on affected systems
   - Quarantine suspicious packages

3. **Investigation**
   - Review pip installation logs
   - Analyze modified files
   - Check for persistence mechanisms
   - Identify attack origin

4. **Recovery**
   - Restore from known-good backups
   - Reinstall packages from trusted sources
   - Rotate credentials
   - Update all systems to pip 25.3 (when available)

5. **Notification**
   - Contact security@lukhas.ai
   - Report to CERT/CC if widespread
   - Coordinate disclosure with affected parties

---

## References

### Official Resources

- **CVE Entry**: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-8869
- **GHSA Advisory**: https://github.com/advisories/GHSA-4xh5-x5gv-qwph
- **Fix PR**: https://github.com/pypa/pip/pull/13550
- **pip Security Policy**: https://pip.pypa.io/en/stable/security/

### LUKHAS Documentation

- **Pip Audit Report**: [docs/audits/security/20251015/pip-audit.md](../audits/security/20251015/pip-audit.md)
- **Vulnerability Fixing Guide**: [FIXING_VULNERABILITIES.md](./FIXING_VULNERABILITIES.md)
- **Security Policy**: [SECURITY.md](../../SECURITY.md)
- **Incident Response Plan**: [incident_response.md](./incident_response.md)

### Standards & Best Practices

- **PEP 706**: Filter for tarfile.extractall (Python 3.13+)
- **SLSA Framework**: https://slsa.dev/
- **OWASP Dependency Check**: https://owasp.org/www-project-dependency-check/
- **Supply Chain Levels for Software Artifacts**: https://slsa.dev/spec/v1.0/

---

## Action Items

### Security Team

- [x] Create comprehensive advisory document
- [ ] Schedule team briefing on CVE-2025-8869
- [ ] Add to security monitoring dashboard
- [ ] Configure alerts for pip 25.3 release
- [ ] Update incident response playbooks

### Development Team

- [ ] Review package installation practices
- [ ] Update CI/CD security controls
- [ ] Test mitigation workarounds
- [ ] Plan pip 25.3 upgrade schedule
- [ ] Document secure dependency management

### Infrastructure Team

- [ ] Implement file system monitoring
- [ ] Configure package source restrictions
- [ ] Enable SLSA provenance checks
- [ ] Review container security policies
- [ ] Test disaster recovery procedures

---

## Timeline

**2025-10-15**: Vulnerability discovered in pip-audit scan  
**2025-10-28**: Advisory document created  
**2025-TBD**: pip 25.3 release (monitoring)  
**2025-TBD**: Upgrade to pip 25.3 (scheduled)  
**2025-Q2**: Evaluate Python 3.13+ migration  

---

## Status Updates

### 2025-10-28
- âœ… Initial advisory created
- âœ… Risk assessment completed
- âœ… Mitigation strategy documented
- ðŸ”„ Team notification pending
- ðŸ“‹ Monitoring automation in planning

---

**Classification**: INTERNAL - Security Team  
**Distribution**: Security Team, DevOps Team, Engineering Leadership  
**Review Frequency**: Weekly until pip 25.3 released, then monthly  
**Next Review**: 2025-11-04  
**Document Owner**: Security Team (security@lukhas.ai)  
**Last Updated**: 2025-10-28
