# Lukhas OpenAI-Compatible API Spec

This directory stores the generated OpenAPI specification document for the Lukhas OpenAI-compatible façade.

## Artifacts

- **`lukhas-openai.json`** - OpenAPI 3.0 specification in JSON format
- Generated automatically in CI by `.github/workflows/matriz-validate.yml` (job: **openapi-spec**)

## Usage

### CI/CD Integration

The OpenAPI spec is generated and uploaded as a CI artifact on every push/PR:

```yaml
# .github/workflows/matriz-validate.yml
openapi-spec:
  name: Build OpenAPI Spec
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with: { python-version: '3.11' }
    - name: Generate spec
      run: |
        python -c "
        from lukhas.adapters.openai.api import get_app
        import json
        app = get_app()
        spec = app.openapi()
        json.dump(spec, open('docs/openapi/lukhas-openai.json', 'w'), indent=2)
        "
    - uses: actions/upload-artifact@v4
      with:
        name: openapi-spec
        path: docs/openapi/lukhas-openapi.json
```

### Local Generation

Generate the spec locally:

```bash
python - <<'PY'
import json
from lukhas.adapters.openai.api import get_app

app = get_app()
spec = app.openapi()

with open("docs/openapi/lukhas-openapi.json", "w") as f:
    json.dump(spec, f, indent=2)

print("✅ Generated docs/openapi/lukhas-openapi.json")
PY
```

### SDK Generation

Use the OpenAPI spec to generate client SDKs:

```bash
# TypeScript/JavaScript
npx @openapitools/openapi-generator-cli generate \
  -i docs/openapi/lukhas-openapi.json \
  -g typescript-fetch \
  -o clients/typescript

# Python
openapi-generator-cli generate \
  -i docs/openapi/lukhas-openapi.json \
  -g python \
  -o clients/python
```

### Contract Testing

Validate API responses against the spec:

```bash
# Using Schemathesis
pip install schemathesis
schemathesis run docs/openapi/lukhas-openapi.json \
  --base-url http://localhost:8000 \
  --checks all

# Using Dredd
npm install -g dredd
dredd docs/openapi/lukhas-openapi.json http://localhost:8000
```

### Diffing Across Releases

Compare API changes between branches:

```bash
# Download specs from CI artifacts
gh run download <run-id-main> -n openapi-spec -D main-spec
gh run download <run-id-pr> -n openapi-spec -D pr-spec

# Diff with openapi-diff
npx openapi-diff main-spec/lukhas-openapi.json pr-spec/lukhas-openapi.json
```

## Endpoints Documented

The spec covers all OpenAI-compatible endpoints:

- **Health**: `/healthz`, `/readyz`, `/metrics`
- **Models**: `/v1/models`
- **Embeddings**: `/v1/embeddings`
- **Responses**: `/v1/responses`
- **Memory Indexes**: `/v1/indexes/*` (CRUD + search)

## Compliance

The API adheres to OpenAI's error envelope format:

```json
{
  "error": {
    "type": "invalid_request_error",
    "message": "Invalid authentication credentials",
    "code": "invalid_api_key"
  }
}
```

## Entry Point

The spec is generated from the FastAPI application factory:

```python
from lukhas.adapters.openai.api import get_app

app = get_app()  # Stable public entrypoint
spec = app.openapi()
```

## Related Documentation

- [OpenAI API Reference](https://platform.openai.com/docs/api-reference)
- [FastAPI OpenAPI Docs](https://fastapi.tiangolo.com/tutorial/metadata/)
- [OpenAPI Specification](https://spec.openapis.org/oas/v3.0.3)

## Maintenance

- Spec is auto-generated - do not edit manually
- Update by modifying route handlers and Pydantic models
- Regenerate after API changes with `make openapi-spec` (if target exists)
- Validate with `openapi-generator-cli validate -i docs/openapi/lukhas-openapi.json`

---

**Generated by**: LUKHAS CI/CD Pipeline  
**Entry Point**: `lukhas.adapters.openai.api:get_app`  
**Last Updated**: Auto-generated on each commit
