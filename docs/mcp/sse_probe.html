<!doctype html>
<meta charset="utf-8" />
<title>Lukhas MCP â€“ SSE Probe</title>
<style>
    body {
        font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        margin: 24px;
        color: #0f172a;
    }

    header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }

    code,
    input {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }

    .row {
        margin: 8px 0;
    }

    #log {
        border: 1px solid #e2e8f0;
        padding: 12px;
        border-radius: 8px;
        background: #f8fafc;
        height: 280px;
        overflow: auto;
    }

    .ok {
        color: #065f46;
    }

    .warn {
        color: #92400e;
    }

    .err {
        color: #7f1d1d;
    }
</style>
<header>
    <h1>ðŸ”´ Lukhas MCP â€” SSE Probe</h1>
</header>

<div class="row">
    <label>Base URL (no trailing slash): </label>
    <input id="base" size="50" value="http://localhost:8766" />
</div>
<div class="row">
    <label>Topic: </label>
    <input id="topic" size="40" value="job/demo" />
</div>
<div class="row">
    <label>API Key: </label>
    <input id="key" size="40" placeholder="X-API-Key (optional)" />
</div>
<button id="connect">Connect</button>
<button id="stop">Stop</button>

<h3>Events</h3>
<pre id="log"></pre>

<script>
    let es;
    function log(cls, msg) {
        const el = document.getElementById('log');
        const line = document.createElement('div');
        line.className = cls;
        line.textContent = `[${new Date().toISOString()}] ${msg}`;
        el.appendChild(line);
        el.scrollTop = el.scrollHeight;
    }
    function connect() {
        const base = document.getElementById('base').value.replace(/\/$/, '');
        const topic = document.getElementById('topic').value;
        const key = document.getElementById('key').value;
        const url = new URL(base + '/sse');
        url.searchParams.set('topic', topic);
        if (key) url.searchParams.set('key', key); // server supports ?key=
        if (es) es.close();
        es = new EventSource(url);
        es.onopen = () => log('ok', 'SSE open: ' + url);
        es.onmessage = (e) => log('ok', 'message: ' + e.data);
        es.addEventListener('queued', (e) => log('ok', 'queued: ' + e.data));
        es.addEventListener('running', (e) => log('warn', 'running: ' + e.data));
        es.addEventListener('completed', (e) => log('ok', 'completed: ' + e.data));
        es.addEventListener('metric', (e) => log('warn', 'metric: ' + e.data));
        es.addEventListener('promoted', (e) => log('ok', 'promoted: ' + e.data));
        es.addEventListener('rolled_back', (e) => log('err', 'rolled_back: ' + e.data));
        es.onerror = (e) => log('err', 'error: ' + (e.message || 'network/error'));
    }
    document.getElementById('connect').onclick = connect;
    document.getElementById('stop').onclick = () => { if (es) es.close(); log('warn', 'SSE closed'); };
</script>