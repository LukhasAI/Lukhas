# Workflow Enforcer Skill

Continuous integration and automation skill that enforces LUKHΛS project hygiene on PRs: ensures `lukhas_context.md` presence, runs doc_autogen in dry-run, validates context sync, runs repo_cleanup checks (dry-run), and blocks merges when mandatory conditions fail.

## Reasoning

1. Quality is achieved through automated gates. Implement a GitHub Action that runs on PRs and on pushes to main branch.

2. The action should run small, fast linters and validators: context presence, context schema validation, doc_autogen (dry-run to surface missing docs), and root cleanliness checks (dry-run).

3. On failure, the action should produce a human-readable report with actionable steps and links to failing files. Maintainers should be able to click a button to run the suggested fixes locally.

4. Use a modular workflow so additional checks (MATRIZ safety checks, drift analyzers) can be added without disrupting the base checks.

5. Ensure that the workflow writes artefacts (context_index.json, doc_autogen_report.json) for human review in the PR.

## Actions

### Suggested GitHub Action `.github/workflows/lukhas_quality.yaml`:

```yaml
name: Lukhas Quality Gates
on: [pull_request, push]
jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with: { 'python-version': '3.10' }
      - name: Install deps
        run: pip install -r requirements.txt || true
      - name: Validate contexts
        run: python3 scripts/context_extractor.py || exit 1
      - name: Lint contexts
        run: scripts/validate_context_files.sh || exit 1
      - name: Run doc autogen dry-run
        run: python3 scripts/doc_autogen.py || exit 1
      - name: Repo cleanup dry-run
        run: bash scripts/lukhas_repo_cleanup.sh || exit 1
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with: { name: context_index, path: context_index.json }
```

### Failure reporting:
The Action should post a summary comment on the PR with a checklist of failures and a link to the uploaded artifacts.

### Enforcement policy:
- **Required**: `lukhas_context.md` for every directory containing source code.
- **Optional/future**: MATRIZ safety checks enforced before merging any PR touching `consciousness/`.

### Maintenance & extension:
Keep workflows modular so new skills can be added as separate jobs. Use a `tools/` directory for shared validator scripts.

## Context References

- `/scripts/validate_context_files.sh`
- `/scripts/context_extractor.py` (suggested) — generated by skill `context_extractor`
- `/scripts/lukhas_repo_cleanup.sh` (suggested) — generated by skill `repo_cleanup`
- `/scripts/doc_autogen.py` (suggested) — generated by skill `doc_autogen`
