{
  "batch_id": "BATCH-CODEX-IDENTITY-INTEGRATION-01",
  "agent": "codex",
  "title": "Identity System Integration - IdentityManager & Î›iD",
  "description": "Implement or integrate IdentityManager from AID (Agent Identity) service across orchestration, brain, and API layers",
  "priority": "HIGH",
  "estimated_total_time": "3h",
  "created": "2025-10-26",
  "status": "pending",
  "tasks": [
    {
      "task_id": "CODEX-IDENTITY-01",
      "title": "Implement IdentityManager in main_node.py",
      "priority": "HIGH",
      "complexity": "HIGH",
      "estimated_time": "1.5h",
      "files": [
        "core/orchestration/brain/orchestration/main_node.py",
        "core/identity/vault/lukhas_id.py"
      ],
      "description": "Create IdentityManager class or import from AID service. Should handle: user authentication, session management, tier-based access control, identity vault integration.",
      "acceptance_criteria": [
        "IdentityManager class exists with get_user_identity() method",
        "Integrates with lukhas_id.py for has_access() and log_access()",
        "Supports tier-based permissions (0-5)",
        "Handles async user identity loading"
      ],
      "location": "core/orchestration/brain/orchestration/main_node.py:89",
      "todo_text": "TODO: IdentityManager - Install or implement AID"
    },
    {
      "task_id": "CODEX-IDENTITY-02",
      "title": "Add IdentityManager to dashboard",
      "priority": "MEDIUM",
      "complexity": "MEDIUM",
      "estimated_time": "1h",
      "files": [
        "core/orchestration/brain/dashboard/main_dashboard.py",
        "core/identity/vault/lukhas_id.py"
      ],
      "description": "Integrate IdentityManager into dashboard for user authentication and session management. Display user tier and permissions.",
      "acceptance_criteria": [
        "Dashboard imports IdentityManager",
        "Shows current user identity and tier",
        "Displays access permissions",
        "Handles authentication failures gracefully"
      ],
      "location": "core/orchestration/brain/dashboard/main_dashboard.py:55",
      "todo_text": "TODO: IdentityManager"
    },
    {
      "task_id": "CODEX-IDENTITY-03",
      "title": "Add identity middleware to API",
      "priority": "MEDIUM",
      "complexity": "MEDIUM",
      "estimated_time": "30m",
      "files": [
        "core/interfaces/api/v1/v1/rest/middleware.py",
        "core/identity/vault/lukhas_id.py"
      ],
      "description": "Create API middleware for identity verification. Extract and validate API keys, map to user identity, enforce tier-based rate limits.",
      "acceptance_criteria": [
        "Middleware extracts API key from headers",
        "Validates key against identity vault",
        "Adds user_id and tier to request context",
        "Returns 401 for invalid keys"
      ],
      "location": "core/interfaces/api/v1/v1/rest/middleware.py:25",
      "todo_text": "TODO: API key lookup from identity vault"
    }
  ],
  "dependencies": [
    "core/identity/vault/lukhas_id.py"
  ],
  "related_batches": [
    "BATCH-CODEX-API-MIDDLEWARE-01"
  ],
  "notes": "IdentityManager is critical infrastructure. Consider whether to implement in-house or integrate external AID service. lukhas_id.py provides has_access() and log_access() primitives."
}
