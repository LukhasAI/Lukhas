# LUKHAS AI Environment Configuration
# Constellation Framework: ‚öõÔ∏èüß†üõ°Ô∏è
# Copy this file to .env and fill in your values
# IMPORTANT: Never commit real API keys!

# Safety-first defaults
LUKHAS_DRY_RUN_MODE=true
LUKHAS_OFFLINE=true
LUKHAS_FEATURE_MATRIX_EMIT=true

# Feature flags (all off unless canaried)
FEATURE_POLICY_DECIDER=false
FEATURE_ORCHESTRATION_HANDOFF=false
FEATURE_IDENTITY_PASSKEY=false
FEATURE_GOVERNANCE_LEDGER=false

# API Keys (NEVER commit real keys!)
# OpenAI: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-REPLACE_WITH_YOUR_KEY

# Anthropic: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-REPLACE_WITH_YOUR_KEY

# Google: https://makersuite.google.com/app/apikey
GOOGLE_API_KEY=AIza_REPLACE_WITH_YOUR_KEY

# Perplexity: https://www.perplexity.ai/settings/api
PERPLEXITY_API_KEY=pplx-REPLACE_WITH_YOUR_KEY

# Database connection (optional)
DATABASE_URL=postgresql://user:password@localhost/lukhas

# Security key for identity system (min 32 chars)
LUKHAS_ID_SECRET=REPLACE_WITH_MIN_32_CHAR_SECRET_KEY

# Ethics enforcement level
# Optional (default: strict)
# Allowed values: strict, moderate, lenient
ETHICS_ENFORCEMENT_LEVEL=strict

# Safety features (keep enabled)
DREAM_SIMULATION_ENABLED=false
QUANTUM_PROCESSING_ENABLED=false
GUARDIAN_ENFORCEMENT=strict
SYMBOLIC_DRIFT_THRESHOLD=0.7
TRINITY_COHERENCE_MIN=0.3

# Logging level
# Optional (default: INFO)
# Allowed values: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# API rate limit per minute
# Optional (default: 100)
# Minimum value: 1
# Maximum value: 10000
API_RATE_LIMIT=100

# Maximum memory folds
# Optional (default: 1000)
# Minimum value: 100
# Maximum value: 10000
MEMORY_FOLD_LIMIT=1000

# Ethical drift detection threshold
# Optional (default: 0.15)
# Minimum value: 0.0
# Maximum value: 1.0
DRIFT_THRESHOLD=0.15

# =============================================================================
# API CONFIGURATION
# =============================================================================

# API Host Configuration
# Optional (default: 0.0.0.0)
LUKHAS_API_HOST=0.0.0.0

# Main Consciousness API Port
# Optional (default: 8080)
LUKHAS_API_PORT=8080

# Universal Language API Port
# Optional (default: 8081)
LUKHAS_LANG_API_PORT=8081

# =============================================================================
# DASHBOARD CONFIGURATION
# =============================================================================

# Dashboard Host
# Optional (default: 0.0.0.0)
LUKHAS_DASHBOARD_HOST=0.0.0.0

# Main Dashboard Port
# Optional (default: 3000)
LUKHAS_DASHBOARD_PORT=3000

# Meta Dashboard Port
# Optional (default: 5042)
LUKHAS_META_DASHBOARD_PORT=5042

# Dashboard Display URL (for logging)
# Optional (default: localhost)
LUKHAS_DASHBOARD_URL=localhost

# Dashboard Refresh Rate (seconds)
# Optional (default: 15)
LUKHAS_REFRESH_RATE=15

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Monitoring API Key (for secure access)
# Optional but recommended for production
LUKHAS_MONITORING_API_KEY=your-monitoring-key-here

# Enable metrics collection
# Optional (default: true)
LUKHAS_METRICS_ENABLED=true

# Metrics collection interval (seconds)
# Optional (default: 1)
LUKHAS_METRICS_INTERVAL=1

# Data Storage Paths
LUKHAS_METRICS_PATH=data/meta_metrics.json
LUKHAS_SNAPSHOTS_PATH=data/drift_audit_results.jsonl
LUKHAS_METRICS_FILE=data/metrics.jsonl
LUKHAS_ALERTS_FILE=data/alerts.jsonl

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# API Key Validation - Comma-separated SHA256 hashes of valid API keys
# Optional - if not set, basic format validation only
LUKHAS_API_KEY_HASHES=hash1,hash2,hash3

# Require API key for monitoring endpoints
# Optional (default: false, set true for production)
LUKHAS_API_KEY_REQUIRED=false

# API Rate limiting
# Optional (default: 1000)
LUKHAS_RATE_LIMIT_API=1000

# =============================================================================
# ŒõiD AUTHENTICATION SYSTEM CONFIGURATION
# =============================================================================

# Authentication Mode Configuration
# Whether to enable password-based authentication (disabled for security)
# REQUIRED (default: false for security)
AUTH_PASSWORD_ENABLED=false

# Magic Link Configuration
# Time-to-live for magic links in seconds (10 minutes default)
# REQUIRED (default: 600)
AUTH_MAGIC_LINK_TTL_SECONDS=600

# JWT Token Configuration
# Access token time-to-live in minutes
# REQUIRED (default: 15)
AUTH_ACCESS_TTL_MINUTES=15

# Refresh token time-to-live in days
# REQUIRED (default: 30)
AUTH_REFRESH_TTL_DAYS=30

# Whether to rotate refresh tokens on use (security best practice)
# REQUIRED (default: true)
AUTH_REFRESH_ROTATE=true

# Whether to detect refresh token reuse (security feature)
# REQUIRED (default: true)
AUTH_REFRESH_REUSE_DETECT=true

# WebAuthn Configuration
# Require user verification for WebAuthn (biometrics/PIN)
# REQUIRED (default: true)
AUTH_REQUIRE_UV=true

# Relying Party ID for WebAuthn (must match domain)
# REQUIRED for production - use domain without protocol
AUTH_RPID=lukhas.ai

# Allowed origins for CORS and WebAuthn
# REQUIRED - comma-separated list of allowed origins
AUTH_ALLOWED_ORIGINS=https://lukhas.ai,https://dev.lukhas.ai

# Tier 5 Enterprise Security Configuration
# Require Single Sign-On for Tier 5 access
# REQUIRED for enterprise (default: true)
T5_REQUIRE_SSO=true

# Require SCIM provisioning for Tier 5 access
# REQUIRED for enterprise (default: true)
T5_REQUIRE_SCIM=true

# JWT Signing Configuration
# RSA private key for JWT signing (PEM format, base64 encoded)
# REQUIRED - generate with: openssl genpkey -algorithm RSA -out private.pem -pkcs8 -outform PEM
JWT_PRIVATE_KEY=your-base64-encoded-rsa-private-key

# RSA public key for JWT verification (PEM format, base64 encoded)
# REQUIRED - extract with: openssl rsa -in private.pem -pubout -out public.pem
JWT_PUBLIC_KEY=your-base64-encoded-rsa-public-key

# Key ID for JWKS rotation
# REQUIRED - unique identifier for current key pair
JWT_KEY_ID=lukhas-auth-2025-q1

# JWKS Configuration
# Endpoint for JSON Web Key Set
# REQUIRED (default: /.well-known/jwks.json)
JWKS_ENDPOINT=/.well-known/jwks.json

# Key rotation schedule (in days)
# REQUIRED (default: 90 for quarterly rotation)
JWKS_ROTATION_DAYS=90

# Email Security Configuration
# SMTP configuration for magic links
# REQUIRED for email-based authentication
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_USER=noreply@lukhas.ai
SMTP_PASSWORD=your-smtp-password
SMTP_FROM_NAME=LUKHAS AI
SMTP_FROM_EMAIL=noreply@lukhas.ai

# Email rate limiting (per IP address per hour)
# REQUIRED (default: 5)
EMAIL_RATE_LIMIT_PER_IP=5

# Email rate limiting (per email address per hour)
# REQUIRED (default: 3)
EMAIL_RATE_LIMIT_PER_EMAIL=3

# Account enumeration protection
# Whether to return same response regardless of email existence
# REQUIRED (default: true for security)
AUTH_PREVENT_ENUMERATION=true

# Session Security
# Secure cookie configuration (requires HTTPS in production)
# REQUIRED (default: true for production)
AUTH_SECURE_COOKIES=true

# SameSite cookie policy
# REQUIRED (default: strict)
AUTH_COOKIE_SAMESITE=strict

# Cookie domain for multi-subdomain support
# Optional - set for multi-subdomain deployments
AUTH_COOKIE_DOMAIN=.lukhas.ai

# Break-Glass Emergency Access Configuration
# Emergency access account email (hardware key + TOTP required)
# REQUIRED for production
BREAK_GLASS_OWNER_EMAIL=security@lukhas.ai

# Emergency access hardware key ID
# REQUIRED for production
BREAK_GLASS_HARDWARE_KEY_ID=your-yubikey-id

# TOTP shared secret for emergency access
# REQUIRED for production - generate with: openssl rand -base64 32
BREAK_GLASS_TOTP_SECRET=your-base64-totp-secret

# Audit and Monitoring
# Whether to log all authentication events
# REQUIRED (default: true)
AUTH_AUDIT_LOGGING=true

# Audit log retention in days
# REQUIRED (default: 365)
AUTH_AUDIT_RETENTION_DAYS=365

# Whether to send alerts on failed authentication attempts
# REQUIRED (default: true)
AUTH_ALERT_ON_FAILURES=true

# Threshold for failed attempts before alerting
# REQUIRED (default: 5)
AUTH_FAILURE_ALERT_THRESHOLD=5

# Development HTTPS Configuration
# Enable HTTPS for localhost development (required for WebAuthn)
# REQUIRED for WebAuthn development (default: true)
DEV_HTTPS_ENABLED=true

# Path to development SSL certificate
# REQUIRED if DEV_HTTPS_ENABLED=true
DEV_SSL_CERT=./certs/localhost.crt

# Path to development SSL private key
# REQUIRED if DEV_HTTPS_ENABLED=true
DEV_SSL_KEY=./certs/localhost.key

# =============================================================================
# EXTERNAL INTEGRATIONS
# =============================================================================

# Prometheus metrics export
LUKHAS_PROMETHEUS_ENABLED=false
LUKHAS_PROMETHEUS_PORT=9090

# Grafana integration
LUKHAS_GRAFANA_ENABLED=false
LUKHAS_GRAFANA_HOST=localhost
LUKHAS_GRAFANA_PORT=3001

# External monitoring services
LUKHAS_DATADOG_ENABLED=false
DATADOG_API_KEY=your-datadog-key

# Slack notifications
LUKHAS_SLACK_ENABLED=false
SLACK_WEBHOOK_URL=https://hooks.slack.com/your-webhook
SLACK_CHANNEL=#lukhas-alerts

# PagerDuty integration
LUKHAS_PAGERDUTY_ENABLED=false
PAGERDUTY_ROUTING_KEY=your-pagerduty-key

# =============================================================================
# FEATURE FLAGS (DEFAULT: OFF in production)
# =============================================================================

# Universal Language System
# Optional (default: false)
UL_ENABLED=false

# VIVOX Consciousness System (Lite Mode)
# Optional (default: false)
VIVOX_LITE=false

# Quantum Inspire Module (Sandboxed)
# Optional (default: false)
QIM_SANDBOX=false

# Core Surface API Version
# REQUIRED - Must match orchestrator/adapters version
BUS_SCHEMA_VERSION=v1

# Deprecation & Migration
# Global shim removal date
SHIM_CULL_DATE=2025-11-01

# Performance Targets
AUTH_P95_TARGET_MS=100
CONTEXT_P95_TARGET_MS=250

# =============================================================================
# DEVELOPMENT/PRODUCTION SETTINGS
# =============================================================================

# Environment (affects security defaults)
# Values: development, production
LUKHAS_ENV=development

# Project root path (for utility scripts)
LUKHAS_ROOT=/path/to/your/lukhas-

# Debug mode
LUKHAS_DEBUG=false

# Mock data for testing
LUKHAS_MOCK_DATA=false

# SSL Configuration (production)
LUKHAS_SSL_ENABLED=false
LUKHAS_SSL_CERT=/path/to/cert.pem
LUKHAS_SSL_KEY=/path/to/key.pem

# CORS Origins (production - restrict as needed)
LUKHAS_CORS_ORIGINS=https://yourdomain.com,https://app.yourdomain.com


=== Conftest.py Safety Defaults ===
def pytest_configure(config):
    """
    Configure pytest with safety-first defaults.
    These settings ensure tests run in dry-run mode by default.
    """
    # Safety-first environment defaults
    os.environ.setdefault("LUKHAS_DRY_RUN_MODE", "true")
    os.environ.setdefault("LUKHAS_OFFLINE", "true")
    os.environ.setdefault("LUKHAS_FEATURE_MATRIX_EMIT", "true")

    # Disable all features by default (safety first)
    os.environ.setdefault("FEATURE_POLICY_DECIDER", "false")
    os.environ.setdefault("FEATURE_ORCHESTRATION_HANDOFF", "false")
    os.environ.setdefault("FEATURE_IDENTITY_PASSKEY", "false")
    os.environ.setdefault("FEATURE_GOVERNANCE_LEDGER", "false")

--
def pytest_configure(config):
    """Register custom markers"""
    config.addinivalue_line(
        "markers", "unit: Unit tests (fast, isolated)"
    )
    config.addinivalue_line(
        "markers", "integration: Integration tests (may require setup)"
    )
    config.addinivalue_line(
        "markers", "e2e: End-to-end tests (full system)"
    )
    config.addinivalue_line(
        "markers", "dry_run: Tests that verify dry-run mode"
    )
    config.addinivalue_line(
        "markers", "safety: Tests that verify safety features"
