# .copilot_tasks.md — LUKHΛS AGI (T4 / 0.01%)





> **Mode:** T4 / 0.01% code surgeon  
> **Principles:** tiny changes, big leverage; fail closed; explicit invariants; tests-first  
> **Feature flag:** set `LUKHAS_EXPERIMENTAL=1` to enable new code paths

## How to use
1. Pick a single task box below. Keep PRs *small* (1 feature = 1 PR).
2. Create/modify only the listed files. Keep new code behind the feature flag.
3. Add unit tests + docstrings (LUKHΛS template with usage block).
4. **DoD:** tests pass, CI green, docs updated, no ABI breaks without notes.

---

## Quick commands
```bash
# Python
export LUKHAS_EXPERIMENTAL=1
pytest -q

# JS (if present)
export LUKHAS_EXPERIMENTAL=1
npm test -s || pnpm test -s || yarn test -s
```
---

## Execution Order (minimize rework)
1) Drift backbone → 2) Constraints & ethics → 3) Bridge & orchestration → 4) Identity & consent → 5) Oneiric → 6) Latent boosters → 7) Collapse Engine

---

## Drift Backbone

- [ ] **(14) Drift Management Module (unify ethical/memory/identity drift)**
  - **Files:** `monitoring/drift_manager.py` (new), `candidate/qi/states/integrity_probe.py` (hook)
  - **Docs:** `docs/architecture/ARCHITECTURAL_DOMAIN_MAPPING.md`, `docs/consciousness/VIVOX_1.md`
  - **Steps:** expose `compute(kind, prev, curr) -> {score, top_symbols}`; return contributors
  - **DoD:** IntegrityProbe consumes drift deltas; reports include top_symbols
  - **Commit:** `feat(drift): unify drift manager + contributors`

- [ ] **(15) Autonomous Drift Correction (callback to repair)**
  - **Files:** `monitoring/drift_manager.py` (callback), `lukhas/trace/TraceRepairEngine.py` (invoke)
  - **Docs:** `docs/development/CANDIDATE_DEEP_DIVE.md`
  - **Steps:** `on_exceed(kind, score, ctx)` → route to reconsolidation/repair; log effect
  - **DoD:** injected drift triggers repair, reduces drift next cycle
  - **Commit:** `feat(drift): auto-repair loop when threshold exceeded`

- [ ] **(7) Integrity hook in AkaQualia loop**
  - **Files:** `candidate/aka_qualia/core.py`
  - **Docs:** `docs/architecture/CONSCIOUSNESS_DISTRIBUTED_SYSTEM.md`
  - **Steps:** after each tick: `IntegrityProbe.run_consistency_check()`; on False → soft reset/repair
  - **DoD:** hook observable in logs; flag-gated
  - **Commit:** `feat(qualia): integrity micro-check per cycle`

---

## Constraints & Ethics

- [ ] **(5) Global Plan Verifier (logic constraints pre-exec)**
  - **Files:** `core/symbolic/constraints/plan_verifier.py` (new), `core/orchestration/agent_orchestrator.py`
  - **Docs:** `ethics/guardian/lukhas_context.md`, `docs/architecture/ARCHITECTURAL_DOMAIN_MAPPING.md`
  - **Steps:** `verify(plan)->(ok, violations[])`; abort dispatch on violations; log to Guardian
  - **DoD:** one real plan path verified; violations surfaced
  - **Commit:** `feat(eqnoX): add plan verifier w/ constraints`

- [ ] **(11) Prolog-like Ethics Engine**
  - **Files:** `ethics/logic/ethics_engine.py` (new), Guardian decision path wiring
  - **Docs:** `ethics/guardian/lukhas_context.md`
  - **Steps:** encode 5+ core rules; `evaluate(ctx)->(allowed, rationale[])`
  - **DoD:** used in one real decision path; rationale human-readable
  - **Commit:** `feat(guardian): logic-based ethics engine`

- [ ] **(12) Guardian Drift Bands (adaptive thresholds)**
  - **Files:** `ethics/guardian_reflector.py`
  - **Docs:** `ethics/guardian/lukhas_context.md`
  - **Steps:** map score→band `'minor'|'major'|'critical'`; actions per band
  - **DoD:** actions vary by band; thresholds configurable
  - **Commit:** `feat(guardian): adaptive ethical drift bands`

- [ ] **(13) Multimodal Safety Tagging**
  - **Files:** `ethics/filters/multimodal.py` (new), Guardian ingestion
  - **Docs:** `docs/development/CANDIDATE_DEEP_DIVE.md`
  - **Steps:** `tag_image(bytes)->set[str]`, `tag_audio(bytes)->set[str]`; apply same rules to tags
  - **DoD:** one end-to-end blocked case via tags
  - **Commit:** `feat(guardian): image/audio symbolic filters`

---

## Bridge & Orchestration

- [ ] **(4) Symbolic Bridge (neural↔symbolic)**
  - **Files:** `core/bridge/symbolic_bridge.py` (new), `candidate/aka_qualia/core.py`
  - **Docs:** `docs/architecture/CONSCIOUSNESS_DISTRIBUTED_SYSTEM.md`, `docs/consciousness/VIVOX_1.md`
  - **Steps:** `to_symbol(payload, modality)`; `from_symbol(symbol_plan)`; wire round-trip
  - **DoD:** AkaQualia calls bridge both ways; typed symbols in logs
  - **Commit:** `feat(bridge): ground sub-symbolic outputs & plans`

- [ ] **(6) Consensus Arbitration (resolve agent conflicts)**
  - **Files:** `candidate/core/orchestration/consensus_arbitrator.py` (new), `core/orchestration/agent_orchestrator.py`
  - **Docs:** `docs/architecture/CONSCIOUSNESS_DISTRIBUTED_SYSTEM.md`
  - **Steps:** score by guardian_ethics, confidence, recency; ΛiD role tie-break
  - **DoD:** stable choice + rationale in logs
  - **Commit:** `feat(orch): consensus arbitrator for conflicting proposals`

- [ ] **(20) Meta‑Reasoning Controller**
  - **Files:** `candidate/core/orchestration/meta_controller.py` (new), orchestrator hook
  - **Docs:** `docs/architecture/CONSCIOUSNESS_DISTRIBUTED_SYSTEM.md`
  - **Steps:** detect loops/conflicts; resolve via rules or escalate
  - **DoD:** synthetic oscillation auto-resolved; logged rationale
  - **Commit:** `feat(orch): meta controller to break loops`

---

## Identity & Consent (ΛiD)

- [ ] **(8) Symbolic Identity Hash + Tier Middleware**
  - **Files:** `identity/symbolic_id_encoder.py` (new), `oneiric_core/identity/auth_middleware.py`
  - **Docs:** `docs/development/IDENTITY_GOVERNANCE_FRAMEWORK.md`
  - **Steps:** SHA-256 + checksum SID; enforce ΛTIER on API endpoints
  - **DoD:** deterministic SID; unauthorized tier blocked
  - **Commit:** `feat(id): add SID encoder + tier checks`

- [ ] **(9) Consent Policy Engine (rules DSL)**
  - **Files:** `identity/consent/policy_engine.py` (new), service entrypoints
  - **Docs:** `docs/development/IDENTITY_GOVERNANCE_FRAMEWORK.md`
  - **Steps:** `allowed(request, rules)->(bool, reason)`; time/purpose policies
  - **DoD:** denials logged with reasons; enforced pre-exec
  - **Commit:** `feat(id): consent policy engine`

- [ ] **(10) Identity Drift Monitor**
  - **Files:** `identity/drift_monitor.py` (new), profile persistence
  - **Docs:** `docs/development/IDENTITY_GOVERNANCE_FRAMEWORK.md`
  - **Steps:** `identity_drift(old_profile, new_activity)->float`; threshold→review flag
  - **DoD:** drift value in audit logs; review triggered
  - **Commit:** `feat(id): identity drift scoring`

---

## Oneiric Core

- [ ] **(16) Symbolic Dream Interpreter**
  - **Files:** `oneiric_core/analysis/symbolic_interpreter.py` (new), DB persist
  - **Docs:** `docs/architecture/ARCHITECTURAL_DOMAIN_MAPPING.md`
  - **Steps:** `interpret(dream)->{symbols[], arcs[]}`; store with dream
  - **DoD:** Journal shows stored symbols for a new dream
  - **Commit:** `feat(oneiric): symbolic interpreter`

- [ ] **(17) Guardian Constraints During Dream Gen**
  - **Files:** `oneiric_core/generation/engine.py`
  - **Docs:** `ethics/guardian/lukhas_context.md`
  - **Steps:** ethics_engine + consent check before finalize; regenerate/redact on violation
  - **DoD:** policy “no violence” respected end-to-end
  - **Commit:** `feat(oneiric): consent/ethics guardrails`

- [ ] **(18) Drift Dream Test (sandbox repair probe)**
  - **Files:** `oneiric_core/tools/drift_dream_test.py` (new CLI)
  - **Docs:** `docs/development/CANDIDATE_DEEP_DIVE.md`
  - **Steps:** `--symbol LOYALTY --user <sid>` ⇒ generate, interpret, report drift delta
  - **DoD:** tool writes concise report; reproducible
  - **Commit:** `feat(oneiric): drift dream test tool`

- [ ] **(19) Symbol Preferences + ΛiD Loop**
  - **Files:** Frontend “Edit Meaning” UI, `oneiric_core/api/symbol_prefs.py` (new)
  - **Docs:** `docs/architecture/ARCHITECTURAL_DOMAIN_MAPPING.md`
  - **Steps:** persist per-user overrides; interpreter respects; ΛiD profile updated
  - **DoD:** UI uses personal meanings; overrides visible
  - **Commit:** `feat(oneiric): per-user symbol meanings`

---

## Latent Boosters

- [ ] **(21) Symbolic Knowledge Base (KB)**
  - **Files:** `core/knowledge/kb.py` (new), caller wiring (Guardian/Verifier)
  - **Docs:** `docs/architecture/LUKHAS_ARCHITECTURE_MASTER.json` (schema cues), `docs/architecture/ARCHITECTURAL_DOMAIN_MAPPING.md`
  - **Steps:** `add_fact`, `query(pattern)`; small unification; precedent queries
  - **DoD:** one path queries KB successfully
  - **Commit:** `feat(kb): minimal symbolic inference store`

- [ ] **(22) Chrono Regulation (bio rhythms)**
  - **Files:** `bio/oscillators/chrono.py` (new), scheduler
  - **Docs:** `docs/architecture/CONSCIOUSNESS_DISTRIBUTED_SYSTEM.md`
  - **Steps:** `phase(now)->{'ACTIVE'|'MAINTENANCE'|'REFLECTION'}`; run heavy tasks in MAINTENANCE
  - **DoD:** collapse sweep moved to maintenance window
  - **Commit:** `feat(bio): chrono regulator for maintenance`

- [ ] **(23) LLM Guardrail (neural interface)**
  - **Files:** `core/bridge/llm_guardrail.py` (new), replace direct LLM calls
  - **Docs:** `docs/development/CANDIDATE_DEEP_DIVE.md`
  - **Steps:** `call_llm(prompt, schema)->dict` with JSON schema validation; strip unsafe
  - **DoD:** one adapter guarded end-to-end
  - **Commit:** `feat(bridge): LLM guardrail with schema`

---

## Collapse Engine

- [ ] **(1) Embedding→Entropy mapping (early drift catch)**
  - **Files:** `core/monitoring/collapse_tracker.py`, `lukhas/trace/embedding_entropy.py` (new)
  - **Docs:** `docs/COLLAPSE_DIAGNOSTICS.md`, `docs/architecture/ARCHITECTURAL_DOMAIN_MAPPING.md`
  - **Steps:** cluster shift/silhouette/center displacement → [0,1] entropy delta; add hook
  - **DoD:** stable clusters ~0; shifts raise delta; tests ≥90%
  - **Commit:** `feat(collapse): map embedding shifts to entropy`

- [ ] **(2) Constraint check before any merge/compression**
  - **Files:** `core/symbolic/collapse/collapse_engine.py`, `core/symbolic/constraints/constraint_engine.py` (new)
  - **Docs:** `docs/COLLAPSE_DIAGNOSTICS.md`
  - **Steps:** `constraint_check(nodes)->bool`; block merges that violate invariants
  - **DoD:** invalid merges abort with audit log; rules are config-driven
  - **Commit:** `feat(collapse): pre-merge constraint guard`

- [ ] **(3) Post-collapse TraceRepair + edge-case simulator**
  - **Files:** `candidate/qi/states/integrity_probe.py`, `lukhas/tools/collapse_simulator.py`
  - **Docs:** `docs/COLLAPSE_DIAGNOSTICS.md`
  - **Steps:** call TraceRepairEngine after collapse; add compound scenarios (memory+ethical+identity)
  - **DoD:** repair path executed & logged; compound simulator CLI works
  - **Commit:** `feat(collapse): repair hook + compound simulator`

---

## Context Map (local docs)
- `docs/architecture/ARCHITECTURAL_DOMAIN_MAPPING.md`
- `docs/architecture/CONSCIOUSNESS_DISTRIBUTED_SYSTEM.md`
- `docs/architecture/LUKHAS_ARCHITECTURE_MASTER.json`
- `docs/development/IDENTITY_GOVERNANCE_FRAMEWORK.md`
- `docs/development/CANDIDATE_DEEP_DIVE.md`
- `ethics/guardian/lukhas_context.md`
- `docs/COLLAPSE_DIAGNOSTICS.md`
- `docs/consciousness/VIVOX_1.md`
- `docs/consciousness/VIVOX_LUKHAS_COMPLETE_FEATURE_MATRIX.md`

---

## Notes
- Keep all new modules documented with **LUKHΛS docstring template** (intro + usage). 
- If a path is missing in this repo, create minimal scaffolding under the same tree.
- Prefer relative imports; avoid side effects on import.
