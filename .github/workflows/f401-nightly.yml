name: f401-nightly-trend
on:
  schedule:
    - cron: "37 2 * * *"   # 02:37 UTC daily
  workflow_dispatch:

jobs:
  nightly:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # allow pushing trend updates (optional)
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332
        with: { ref: main }
      - uses: actions/setup-python@82c7e631bb3cdc910f68e0081d67478d79c6982d
        with: { python-version: "3.11" }
      - run: |
          python -m pip install ruff
          mkdir -p reports/audit
          python3 -m ruff check --select F401 --output-format json > reports/audit/f401.json || true
          python3 tools/ci/f401_trend.py
      - name: Commit trend CSV (optional)
        run: |
          git config user.name "lukhas-bot"
          git config user.email "bot@lukhas.ai"
          if ! git diff --quiet reports/audit/f401_trends.csv; then
            git add reports/audit/f401_trends.csv
            git commit -m "ci(f401): nightly trend append"
            git push
          else
            echo "No F401 trend changes to commit."
          fi
      - uses: actions/upload-artifact@834a144ee995460fba8ed112a2fc961b36a5ec5a
        with:
          name: f401-nightly
          path: |
            reports/audit/f401.json
            reports/audit/f401_trends.csv