name: Logging Tag Guard

on:
  pull_request:
    paths:
      - 'serve/**'
      - 'tests/contract/**'
      - '.github/workflows/logging-tag-guard.yml'
      - 'Makefile'

jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install ripgrep
        run: |
          sudo apt-get update
          sudo apt-get install -y ripgrep
      - name: Detect disallowed logging kwargs (ΛTAG)
        run: |
          set -e
          # Allow LIST: patterns in non-logging contexts (manifests/audit dicts), flag logger calls only
          if rg -n "logger\.(info|warning|error|debug)\(.*ΛTAG=" -S | tee /tmp/tag_hits.txt; then
            echo "Disallowed logging kwarg 'ΛTAG=' found; use formatted string fields instead." >&2
            exit 1
          fi
          echo "No disallowed logging kwargs detected."

