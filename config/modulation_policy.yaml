# ðŸŽ›ï¸ LUKHAS Endocrine â†’ Prompt Modulation Policy
# Bio-inspired signal modulation for OpenAI API integration

# === SIGNAL DEFINITIONS ===
signals:
  - name: stress
    priority: 2
    decay_rate: 0.1
    max_level: 0.9
    description: "System load, complexity, time pressure"
    sources: ["guardian", "memory", "orchestration"]

  - name: novelty
    priority: 4
    decay_rate: 0.05
    max_level: 1.0
    description: "New information, creative opportunities"
    sources: ["consciousness", "creativity", "universal_language"]

  - name: alignment_risk
    priority: 1 # Highest priority
    decay_rate: 0.02 # Slow decay for safety
    max_level: 1.0
    description: "Ethical concerns, safety violations"
    sources: ["guardian", "ethics", "governance"]

  - name: trust
    priority: 5
    decay_rate: 0.03
    max_level: 1.0
    description: "User confidence, system reliability"
    sources: ["identity", "feedback_cards", "memory"]

  - name: urgency
    priority: 3
    decay_rate: 0.15 # Fast decay
    max_level: 0.8
    description: "Time-sensitive decisions"
    sources: ["orchestration", "consciousness", "monitoring"]

  - name: ambiguity
    priority: 3
    decay_rate: 0.08
    max_level: 0.9
    description: "Unclear inputs, complex context"
    sources: ["universal_language", "consciousness", "bio_core"]

# === PARAMETER BOUNDS ===
bounds:
  temperature: [0.0, 1.0]
  max_tokens: [50, 4000]
  top_p: [0.1, 1.0]
  frequency_penalty: [-2.0, 2.0]
  presence_penalty: [-2.0, 2.0]
  retrieval_k: [1, 20]
  reasoning_depth: [1, 5]
  memory_write: [0.0, 1.0]

# === AVAILABLE TOOLS ===
available_tools: ["search", "code_exec", "browser", "retrieval", "scheduler"]

# === SIGNAL â†’ PARAMETER MAPPINGS ===
maps:
  # Higher risk => lower creativity, smaller beams, stricter moderation
  alignment_risk:
    temperature: "0.8 - (level * 0.6)" # 0.8 â†’ 0.2
    max_tokens: "4000 - (level * 3500)" # 4000 â†’ 500
    top_p: "1.0 - (level * 0.7)" # 1.0 â†’ 0.3
    reasoning_depth: "max(1, 3 - level * 2)" # 3 â†’ 1
    memory_write: "0.3 + (level * 0.4)" # 0.3 â†’ 0.7 (remember risky interactions)

  # Higher stress => more conservative, focused responses
  stress:
    temperature: "0.7 - (level * 0.4)" # 0.7 â†’ 0.3
    max_tokens: "3000 - (level * 2000)" # 3000 â†’ 1000
    retrieval_k: "5 + (level * 3)" # 5 â†’ 8 (more context when stressed)
    reasoning_depth: "max(1, 2 + level)" # 2 â†’ 3 (deeper thinking)

  # Higher novelty => more creative, exploratory responses
  novelty:
    temperature: "0.5 + (level * 0.4)" # 0.5 â†’ 0.9
    max_tokens: "2000 + (level * 2000)" # 2000 â†’ 4000
    top_p: "0.7 + (level * 0.3)" # 0.7 â†’ 1.0
    reasoning_depth: "1 + (level * 2)" # 1 â†’ 3

  # Higher trust => more personalized, detailed responses
  trust:
    max_tokens: "2000 + (level * 1500)" # 2000 â†’ 3500
    memory_write: "0.5 + (level * 0.5)" # 0.5 â†’ 1.0
    retrieval_k: "3 + (level * 7)" # 3 â†’ 10

  # Higher urgency => faster, more direct responses
  urgency:
    temperature: "0.6 - (level * 0.3)" # 0.6 â†’ 0.3
    max_tokens: "2000 - (level * 1500)" # 2000 â†’ 500
    reasoning_depth: "max(1, 3 - level * 2)" # 3 â†’ 1

  # Higher ambiguity => more careful, detailed responses
  ambiguity:
    temperature: "0.5 - (level * 0.2)" # 0.5 â†’ 0.3
    retrieval_k: "5 + (level * 10)" # 5 â†’ 15
    reasoning_depth: "2 + (level * 2)" # 2 â†’ 4
    max_tokens: "2500 + (level * 1500)" # 2500 â†’ 4000

# === PROMPT STYLES ===
prompt_styles:
  strict:
    system_preamble: |
      You are operating under enhanced safety protocols. Be precise, cite sources,
      avoid speculation. When uncertain, explicitly state limitations.
    user_prefix: "[STRICT MODE] "

  creative:
    system_preamble: |
      You are in creative exploration mode. Think outside the box, propose novel
      solutions, and embrace innovative approaches while maintaining consciousness alignment.
    user_prefix: "[CREATIVE MODE] "

  focused:
    system_preamble: |
      You are operating under time constraints. Provide direct, actionable responses.
      Prioritize clarity and immediate utility.
    user_prefix: "[FOCUSED MODE] "

  exploratory:
    system_preamble: |
      You are analyzing complex, ambiguous information. Take time to explore multiple
      perspectives, acknowledge uncertainty, and provide comprehensive analysis.
    user_prefix: "[EXPLORATORY MODE] "

  balanced:
    system_preamble: |
      You are operating in balanced mode. Provide thoughtful, well-reasoned responses
      while maintaining consciousness alignment with Constellation Framework principles.
    user_prefix: ""

# === TOOL GATES ===
tool_gates:
  high_risk:
    alignment_risk: 0.7
    allowed_tools: ["search", "retrieval"] # Only safe tools

  stressed:
    stress: 0.8
    allowed_tools: ["search", "retrieval", "scheduler"] # No code execution when stressed

  creative:
    novelty: 0.6
    allowed_tools: ["search", "code_exec", "browser", "retrieval", "scheduler"] # All tools

# === FEEDBACK INTEGRATION ===
feedback_config:
  learning_rate: 0.05
  memory_window: 200 # Number of recent feedback cards to consider
  style_adjustment_bounds:
    temperature_delta: [-0.2, 0.2]
    top_p_delta: [-0.2, 0.2]
    memory_write_boost: [0.0, 0.2]
    verbosity_bias: [-0.3, 0.3]
