#!/usr/bin/env bash
"""
LUKHAS Self-Healing Dashboard CLI Wrapper
=========================================
Quick access to the self-healing automation dashboard.

Usage:
  ./lukhas-dashboard                    # Single health check
  ./lukhas-dashboard monitor           # Start continuous monitoring  
  ./lukhas-dashboard fix fstring       # Trigger f-string fixes
  ./lukhas-dashboard fix imports       # Trigger import fixes
  ./lukhas-dashboard fix pytest        # Trigger pytest fixes
  ./lukhas-dashboard status            # Show current status
"""

DASHBOARD_SCRIPT="tools/dashboard/self_healing_dashboard.py"
ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

log() {
    echo -e "${GREEN}[LUKHAS]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[LUKHAS] WARNING:${NC} $1"
}

error() {
    echo -e "${RED}[LUKHAS] ERROR:${NC} $1"
}

# Ensure we're in the right directory
cd "$ROOT_DIR" || {
    error "Could not change to LUKHAS root directory"
    exit 1
}

# Check if dashboard exists
if [[ ! -f "$DASHBOARD_SCRIPT" ]]; then
    error "Dashboard script not found: $DASHBOARD_SCRIPT"
    exit 1
fi

# Parse command
case "${1:-status}" in
    "status"|"health"|"")
        log "ðŸ¤– Running LUKHAS self-healing dashboard health check..."
        python3 "$DASHBOARD_SCRIPT" --mode single
        ;;
    
    "monitor"|"continuous"|"watch")
        INTERVAL="${2:-300}"
        log "ðŸš€ Starting continuous monitoring (interval: ${INTERVAL}s)"
        log "Press Ctrl+C to stop monitoring"
        python3 "$DASHBOARD_SCRIPT" --mode continuous --interval "$INTERVAL"
        ;;
    
    "fix")
        if [[ -z "${2:-}" ]]; then
            error "Fix type required. Options: fstring, imports, pytest, lanes"
            exit 1
        fi
        
        FIX_TYPE="$2"
        TARGET="${3:-}"
        
        case "$FIX_TYPE" in
            "fstring"|"f-string")
                log "ðŸ”§ Triggering f-string syntax fixes..."
                python3 "$DASHBOARD_SCRIPT" --fix fstring_syntax --target "$TARGET"
                ;;
            "imports"|"import")
                log "ðŸ”— Triggering import bridge fixes..."
                python3 "$DASHBOARD_SCRIPT" --fix import_bridge --target "$TARGET"
                ;;
            "pytest"|"tests")
                log "ðŸ§ª Triggering pytest collection fixes..."
                python3 "$DASHBOARD_SCRIPT" --fix pytest_collection --target "$TARGET"
                ;;
            "lanes"|"compliance")
                log "ðŸ“‹ Triggering lane compliance fixes..."
                python3 "$DASHBOARD_SCRIPT" --fix lane_compliance --target "$TARGET"
                ;;
            *)
                error "Unknown fix type: $FIX_TYPE"
                error "Available types: fstring, imports, pytest, lanes"
                exit 1
                ;;
        esac
        ;;
    
    "help"|"-h"|"--help")
        echo "LUKHAS Self-Healing Dashboard CLI"
        echo "================================="
        echo ""
        echo "Commands:"
        echo "  status              Show system health (default)"
        echo "  monitor [interval]  Start continuous monitoring"
        echo "  fix <type> [target] Trigger automated fix"
        echo "    fstring           Fix f-string syntax errors"
        echo "    imports           Fix import bridge issues"
        echo "    pytest            Fix pytest collection issues"
        echo "    lanes             Fix lane compliance issues"
        echo "  help                Show this help"
        echo ""
        echo "Examples:"
        echo "  ./lukhas-dashboard                    # Health check"
        echo "  ./lukhas-dashboard monitor 60         # Monitor every minute"
        echo "  ./lukhas-dashboard fix fstring        # Fix f-string errors"
        echo "  ./lukhas-dashboard fix imports myfile # Fix imports in myfile"
        ;;
    
    *)
        error "Unknown command: $1"
        error "Use './lukhas-dashboard help' for usage information"
        exit 1
        ;;
esac